<div class="col-0 align-left">
    <a hx-get="{% url 'board-list' %}" hx-target="#board-list" hx-push-url="/boards">back to boards</a>
    <div class="container-fluid">
        <h3>{{board.title}}</h3>
        <!--<a onclick="saveGrid()" class="btn btn-primary" href="#">Save</a>
        <a onclick="loadGrid()" class="btn btn-primary" href="#">Load</a>
        <a onclick="saveFullGrid()" class="btn btn-primary" href="#">Save Full</a>
        <a onclick="loadFullGrid()" class="btn btn-primary" href="#">Load Full</a>
        <a onclick="clearGrid()" class="btn btn-primary" href="#">Clear</a>
<a onclick="addWidget()" class="btn btn-primary" href="#">Add Widget</a>-->
        <div id="gridCont">
            <div class="grid-stack"></div>
        </div>
        <textarea id="saved-data" style="width: 100%" cols="100" rows="20" readonly="readonly"></textarea>
    </div>
    <script type="text/javascript">
        // NOTE: REAL apps would sanitize-html or DOMPurify before blinding setting innerHTML. see #2736
        GridStack.renderCB = function (el, w) {
            el.innerHTML = w.content;
        };
        let serializedData = {{serialized_elements | safe}};
        serializedData.forEach((n, i) => {
            //n.id = String(i);
            n.content = `<button onClick="grid.removeWidget(this.parentNode.parentNode)" hx-confirm="Are you sure you wish to delete?">x</button><br> ${n.id}<br> ${n.content ? n.content : ''}`;
        });
        let serializedFull;

        let grid = GridStack.init({
            minRow: 11, // don't let it collapse when empty
            cellHeight: 80,
            float: true,
            draggable: {cancel: '.no-drag'} // example of additional custom elements to skip drag on
        }).load(serializedData);
        addEvents(grid);

        function removeWidget(el) {
            el.remove();
            grid.removeWidget(el, false);
        }

        function addWidget() {
            let n = {
                x: 0,
                y: 0,
                w: Math.round(1 + 3 * Math.random()),
                h: Math.round(1 + 3 * Math.random()),
                content: '<button onClick="grid.removeWidget(this.parentNode.parentNode)">X</button><br>',
            };
            grid.addWidget(n);
        };

        function addEvents(grid) {
            grid.on('added removed change', function (event, items) {
                if (!items || items.length === 0) {
                    console.log('No items changed.');
                    return;
                }

                if (event.type === 'change') {
                    items.forEach(function (item) {
                        htmx.ajax('POST', `/update-element/`, {
                            headers: {'X-CSRFToken': '{{ csrf_token }}'},
                            target: null,
                            values: {
                                id: item.id,
                                x: item.x,
                                y: item.y,
                                w: item.w,
                                h: item.h,
                                pk: {{board.id}},
                    }
            });
        });
        } else if (event.type === 'removed') {
            items.forEach(function (item) {
                htmx.ajax('DELETE', `/delete-element/`, {
                    headers: {'X-CSRFToken': '{{ csrf_token }}'},
                    target: null,
                    values: {
                        id: item.id,
                        pk: {{board.id}},
                    }
                });
            });
        }
    });
}


    </script>
</div>
