{% extends 'base.html' %}
{% load static %}

{% block content %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{{ board.title }}</title>

    <link rel="stylesheet" href="{% static 'demo.css' %}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gridstack.js/7.2.1/gridstack-all.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/gridstack.js/7.2.1/gridstack.min.css" />
</head>

<body>
    <div class="container-fluid">
        <h1>{{ board.title }}</h1>
        <p>{{ board.description }}</p>
        <a onclick="saveGrid()" class="btn btn-primary" href="#">Save</a>
        <a onclick="loadGrid()" class="btn btn-primary" href="#">Load</a>
        <a onclick="clearGrid()" class="btn btn-primary" href="#">Clear</a>
        <a onclick="addWidget()" class="btn btn-primary" href="#">Add Widget</a>
        <br /><br />
        <div id="gridCont" >
            <div class="grid-stack"style="width: 100vw;"></div>
        </div>
        <hr />
        <textarea id="saved-data" style="width: 100%" cols="100" rows="20" readonly="readonly"></textarea>
    </div>
    <script type="text/javascript">
        GridStack.renderCB = function (el, w) {
            el.innerHTML = w.content;
        };

        let serializedData = {{serialized_elements| safe }};

        let grid = GridStack.init({
            minRow: 1,
            cellHeight: 80,
            float: true,
            draggable: {cancel: '.no-drag'}
        }).load(serializedData);

        function loadGrid() {
            grid.load(serializedData);
        }

        function saveGrid() {
            serializedData = grid.save();
            document.querySelector('#saved-data').value = JSON.stringify(serializedData, null, '  ');
        }

        function clearGrid() {
            grid.removeAll();
        }

        function addWidget() {
            let n = {
                w: Math.round(1 + 3 * Math.random()),
                h: Math.round(1 + 3 * Math.random()),
                content: '<button onClick="grid.removeWidget(this.parentNode.parentNode)">X</button><br>',
            };
            grid.addWidget(n);
        };
    </script>
</body>

</html>
{% endblock content %}
